{% extends "base.html" %}
{% block title %}Shopping Cart - Store{% endblock %}
{% block content %}
<div class="cart-container">
    <h1>Shopping Cart</h1>

    <div class="cart-wrapper">
        <!-- Cart Items -->
        <div class="cart-items">
            {% if cartItems %}
            <table class="cart-table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Total</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Cart Item 1 -->
                     {% for item in cartItems %}
                    <tr class="cart-item">
                        <td class="product-info">
                              <a  href="{{ url_for('productPage', product_id=item.product._id) }}" class="text-link">
                                  <img src="{{ item.product.image_url }}" alt="Product">
                                  <div>
                                      <h4>{{ item.product.product_name }}</h4>
                                      <p class="product-id">SKU: {{ item.product._id }}</p>
                                    </a>
                                    </div>
                        </td>
                        <td class="price">{{ item.product.price }}₪</td>

                        <td class="quantity">

                            <div class="quantity-selector">
                                <form action="{{ url_for('updateCartQuantity', cart_id=item._id) }}" method="POST" style="display:inline;">
                                    <input type="hidden" name="quantity" value="{{ item.quantity - 1 }}">
                                    <button type="submit" class="qty-btn" {% if item.quantity <= 1 %}disabled{% endif %}>−</button>
                                </form>
                                <span class="qty-display">{{ item.quantity }}</span>
                                <form action="{{ url_for('updateCartQuantity', cart_id=item._id) }}" method="POST" style="display:inline;">
                                    <input type="hidden" name="quantity" value="{{ item.quantity + 1 }}">
                                    <button type="submit" class="qty-btn">+</button>
                                </form>
                            </div>
                       
                        </td>
                        <td class="total">{{ item.product.price * item.quantity }}₪</td>
                        <td class="action">
                            <form action="{{ url_for('removeFromCart', cart_id=item._id) }}" method="POST" style="display:inline;">
                                <button type="submit" class="remove-btn">Remove</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            {% else %}
            <!-- Empty Cart Message (hidden by default) -->
            <div class="empty-cart" style="text-align: center; padding: 40px;">
                <h2>Your cart is empty</h2>
                <p>Add some products to get started!</p>
                <a href="/" class="continue-shopping">Continue Shopping</a>
            </div>
            {% endif %}
        </div>

        <!-- Cart Summary -->
         {% if cartItems %}
        <div class="cart-summary">
            <h2>Order Summary</h2>

            <div class="summary-item">
                <span>Subtotal:</span>
                <span>{{ subtotal }}₪</span>
            </div>

            <div class="summary-item">
                <span>Shipping:</span>
                <span>Free</span>
            </div>
            <div class="summary-divider"></div>

            <div class="summary-item total-amount">
                <span>Total:</span>
                <span>{{ subtotal }}₪</span>
            </div>

            <button class="checkout-btn">Proceed to Checkout</button>
            <a href="/" class="continue-shopping-link">Continue Shopping</a>
        </div>
        {% endif %}
    </div>

    <!-- Recommended Products -->
    <div class="recommended-section">
        <h2>You Might Also Like</h2>
       <div class="products-grid">
            <!-- Product Card -->
              {% for product in products %}
           <div class="product-card">
                <a  href="{{ url_for('productPage', product_id=product._id) }}" class="text-link">
                    <div class="product-image">
                        <img src="{{  product.image_url }}" alt="{{ product.product_name }}">
                    </div>
                    <div class="product-info">
                        <h3>{{ product.product_name }}</h3>
                        <p class="price">{{ product.price }}₪</p>
                        {% if product.stock > 0  %}
                         <form action="{{ url_for('addToCart', product_id=product._id) }}" method="post">
                            <button type="submit" class="add-to-cart-btn">Add to Cart</button>
                         </form>
                         {% else %}
                            <h3>Out of stock</h3>
                        {% endif %}
                        </a>
                </div>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}